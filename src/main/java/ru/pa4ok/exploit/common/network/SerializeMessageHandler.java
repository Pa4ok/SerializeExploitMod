package ru.pa4ok.exploit.common.network;

import cpw.mods.fml.common.FMLLog;
import cpw.mods.fml.common.network.simpleimpl.IMessage;
import cpw.mods.fml.common.network.simpleimpl.IMessageHandler;
import cpw.mods.fml.common.network.simpleimpl.MessageContext;

import java.io.ByteArrayInputStream;
import java.io.ObjectInputStream;

public class SerializeMessageHandler implements IMessageHandler<SerializeMessage, IMessage>
{
    @Override
    public IMessage onMessage(SerializeMessage message, MessageContext ctx)
    {
        try(ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(message.getContent()))) {
            FMLLog.info("Reading message " + message.getTitle() + " " + message.getSize());
            Object payload = ois.readObject();
            FMLLog.info("===============================================================");
            FMLLog.info("Message read " + payload.getClass());
            FMLLog.info("===============================================================");
        } catch (Throwable t) {
            t.printStackTrace();
        }

        return null;
    }
}
